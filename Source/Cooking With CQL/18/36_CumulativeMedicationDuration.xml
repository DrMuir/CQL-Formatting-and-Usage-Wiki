<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <identifier id="CumulativeMedicationDuration"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" localIdentifier="QDM" uri="urn:healthit-gov:qdm:v5_0_1_draft" version="5.0.2"/>
   </usings>
   <codeSystems>
      <def localId="2" name="EventTiming" id="urn:oid:2.16.840.1.113883.4.642.1.69" accessLevel="Public"/>
   </codeSystems>
   <codes>
      <def localId="4" name="HS" id="HS" accessLevel="Public">
         <codeSystem localId="3" name="EventTiming"/>
      </def>
      <def localId="6" name="WAKE" id="WAKE" accessLevel="Public">
         <codeSystem localId="5" name="EventTiming"/>
      </def>
      <def localId="8" name="C" id="C" accessLevel="Public">
         <codeSystem localId="7" name="EventTiming"/>
      </def>
      <def localId="10" name="CM" id="CM" accessLevel="Public">
         <codeSystem localId="9" name="EventTiming"/>
      </def>
      <def localId="12" name="CD" id="CD" accessLevel="Public">
         <codeSystem localId="11" name="EventTiming"/>
      </def>
      <def localId="14" name="CV" id="CV" accessLevel="Public">
         <codeSystem localId="13" name="EventTiming"/>
      </def>
      <def localId="16" name="AC" id="AC" accessLevel="Public">
         <codeSystem localId="15" name="EventTiming"/>
      </def>
      <def localId="18" name="ACM" id="ACM" accessLevel="Public">
         <codeSystem localId="17" name="EventTiming"/>
      </def>
      <def localId="20" name="ACD" id="ACD" accessLevel="Public">
         <codeSystem localId="19" name="EventTiming"/>
      </def>
      <def localId="22" name="ACV" id="ACV" accessLevel="Public">
         <codeSystem localId="21" name="EventTiming"/>
      </def>
      <def localId="24" name="PC" id="PC" accessLevel="Public">
         <codeSystem localId="23" name="EventTiming"/>
      </def>
      <def localId="26" name="PCM" id="PCM" accessLevel="Public">
         <codeSystem localId="25" name="EventTiming"/>
      </def>
      <def localId="28" name="PCD" id="PCD" accessLevel="Public">
         <codeSystem localId="27" name="EventTiming"/>
      </def>
      <def localId="30" name="PCV" id="PCV" accessLevel="Public">
         <codeSystem localId="29" name="EventTiming"/>
      </def>
   </codes>
   <statements>
      <def name="Patient" context="Patient">
         <expression xsi:type="SingletonFrom">
            <operand xmlns:ns0="urn:healthit-gov:qdm:v5_0_1_draft" dataType="ns0:Patient" templateId="Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="98" name="ToDaily" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="98">
               <a:s>define function ToDaily(Frequency </a:s>
               <a:s r="31">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="97">
                  <a:s r="97">
                     <a:s>case </a:s>
                     <a:s r="33">
                        <a:s r="32">
                           <a:s>Frequency</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="33">
                           <a:s>unit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="39">
                        <a:s>when </a:s>
                        <a:s r="34">
                           <a:s>'h'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="38">
                           <a:s>(</a:s>
                           <a:s r="38">
                              <a:s r="35">24.0 / </a:s>
                              <a:s r="37">
                                 <a:s r="36">
                                    <a:s>Frequency</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="37">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="47">
                        <a:s>when </a:s>
                        <a:s r="40">
                           <a:s>'min'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="46">
                           <a:s r="44">
                              <a:s>(</a:s>
                              <a:s r="44">
                                 <a:s r="41">24.0 / </a:s>
                                 <a:s r="43">
                                    <a:s r="42">
                                       <a:s>Frequency</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="43">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="57">
                        <a:s>when </a:s>
                        <a:s r="48">
                           <a:s>'s'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="56">
                           <a:s r="54">
                              <a:s r="52">
                                 <a:s>(</a:s>
                                 <a:s r="52">
                                    <a:s r="49">24.0 / </a:s>
                                    <a:s r="51">
                                       <a:s r="50">
                                          <a:s>Frequency</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="51">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> * 60</a:s>
                           </a:s>
                           <a:s> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="65">
                        <a:s>when </a:s>
                        <a:s r="58">
                           <a:s>'d'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="64">
                           <a:s r="62">
                              <a:s>(</a:s>
                              <a:s r="62">
                                 <a:s r="59">24.0 / </a:s>
                                 <a:s r="61">
                                    <a:s r="60">
                                       <a:s>Frequency</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="61">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="75">
                        <a:s>when </a:s>
                        <a:s r="66">
                           <a:s>'wk'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="74">
                           <a:s r="70">
                              <a:s>(</a:s>
                              <a:s r="70">
                                 <a:s r="67">24.0 / </a:s>
                                 <a:s r="69">
                                    <a:s r="68">
                                       <a:s>Frequency</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="69">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="73">
                              <a:s>(</a:s>
                              <a:s r="73">
                                 <a:s r="71">24 * 7</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="85">
                        <a:s>when </a:s>
                        <a:s r="76">
                           <a:s>'mo'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="84">
                           <a:s r="80">
                              <a:s>(</a:s>
                              <a:s r="80">
                                 <a:s r="77">24.0 / </a:s>
                                 <a:s r="79">
                                    <a:s r="78">
                                       <a:s>Frequency</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="79">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="83">
                              <a:s>(</a:s>
                              <a:s r="83">
                                 <a:s r="81">24 * 30</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> // assuming 30 days in month&#xd;
    </a:s>
                     <a:s r="95">
                        <a:s>when </a:s>
                        <a:s r="86">
                           <a:s>'a'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="94">
                           <a:s r="90">
                              <a:s>(</a:s>
                              <a:s r="90">
                                 <a:s r="87">24.0 / </a:s>
                                 <a:s r="89">
                                    <a:s r="88">
                                       <a:s>Frequency</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="89">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="93">
                              <a:s>(</a:s>
                              <a:s r="93">
                                 <a:s r="91">24 * 365</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> // assuming 365 days in year&#xd;
    else null&#xd;
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="97" xsi:type="Case">
            <comparand localId="33" path="unit" xsi:type="Property">
               <source localId="32" name="Frequency" xsi:type="OperandRef"/>
            </comparand>
            <caseItem localId="39">
               <when localId="34" valueType="t:String" value="h" xsi:type="Literal"/>
               <then localId="38" xsi:type="Divide">
                  <operand localId="35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                  <operand localId="37" path="value" xsi:type="Property">
                     <source localId="36" name="Frequency" xsi:type="OperandRef"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="47">
               <when localId="40" valueType="t:String" value="min" xsi:type="Literal"/>
               <then localId="46" xsi:type="Multiply">
                  <operand localId="44" xsi:type="Divide">
                     <operand localId="41" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="43" path="value" xsi:type="Property">
                        <source localId="42" name="Frequency" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="45" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="57">
               <when localId="48" valueType="t:String" value="s" xsi:type="Literal"/>
               <then localId="56" xsi:type="Multiply">
                  <operand localId="54" xsi:type="Multiply">
                     <operand localId="52" xsi:type="Divide">
                        <operand localId="49" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="51" path="value" xsi:type="Property">
                           <source localId="50" name="Frequency" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <operand localId="53" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="55" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="65">
               <when localId="58" valueType="t:String" value="d" xsi:type="Literal"/>
               <then localId="64" xsi:type="Divide">
                  <operand localId="62" xsi:type="Divide">
                     <operand localId="59" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="61" path="value" xsi:type="Property">
                        <source localId="60" name="Frequency" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="63" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="75">
               <when localId="66" valueType="t:String" value="wk" xsi:type="Literal"/>
               <then localId="74" xsi:type="Divide">
                  <operand localId="70" xsi:type="Divide">
                     <operand localId="67" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="69" path="value" xsi:type="Property">
                        <source localId="68" name="Frequency" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="73" xsi:type="Multiply">
                        <operand localId="71" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="72" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="85">
               <when localId="76" valueType="t:String" value="mo" xsi:type="Literal"/>
               <then localId="84" xsi:type="Divide">
                  <operand localId="80" xsi:type="Divide">
                     <operand localId="77" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="79" path="value" xsi:type="Property">
                        <source localId="78" name="Frequency" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="83" xsi:type="Multiply">
                        <operand localId="81" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="82" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="95">
               <when localId="86" valueType="t:String" value="a" xsi:type="Literal"/>
               <then localId="94" xsi:type="Divide">
                  <operand localId="90" xsi:type="Divide">
                     <operand localId="87" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="89" path="value" xsi:type="Property">
                        <source localId="88" name="Frequency" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="93" xsi:type="Multiply">
                        <operand localId="91" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="92" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <else asType="t:Decimal" xsi:type="As">
               <operand localId="96" xsi:type="Null"/>
               <asTypeSpecifier name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
            </else>
         </expression>
         <operand name="Frequency">
            <operandTypeSpecifier localId="31" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="106" name="ToDaily" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="106">
               <a:s>define function ToDaily(Frequency </a:s>
               <a:s r="99">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="105">
                  <a:s r="105">
                     <a:s>case </a:s>
                     <a:s r="100">
                        <a:s>Frequency</a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="103">
                        <a:s>when </a:s>
                        <a:s r="101">
                           <a:s>&quot;C&quot;</a:s>
                        </a:s>
                        <a:s> then 3</a:s>
                     </a:s>
                     <a:s>&#xd;
    // etc.&#xd;
    else null&#xd;
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="105" xsi:type="Case">
            <comparand localId="100" name="Frequency" xsi:type="OperandRef"/>
            <caseItem localId="103">
               <when localId="101" name="C" xsi:type="CodeRef"/>
               <then localId="102" valueType="t:Integer" value="3" xsi:type="Literal"/>
            </caseItem>
            <else asType="t:Integer" xsi:type="As">
               <operand localId="104" xsi:type="Null"/>
               <asTypeSpecifier name="t:Integer" xsi:type="NamedTypeSpecifier"/>
            </else>
         </expression>
         <operand name="Frequency">
            <operandTypeSpecifier localId="99" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="123" name="ToDaily" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="123">
               <a:s>define function ToDaily(Frequency </a:s>
               <a:s r="109">
                  <a:s>Choice&lt;</a:s>
                  <a:s r="107">
                     <a:s>Quantity</a:s>
                  </a:s>
                  <a:s>, </a:s>
                  <a:s r="108">
                     <a:s>Code</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="122">
                  <a:s r="122">
                     <a:s>case&#xd;
    </a:s>
                     <a:s r="117">
                        <a:s>when </a:s>
                        <a:s r="112">
                           <a:s r="110">
                              <a:s>Frequency</a:s>
                           </a:s>
                           <a:s> is </a:s>
                           <a:s r="111">
                              <a:s>Quantity</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="116">
                           <a:s>ToDaily(</a:s>
                           <a:s r="115">
                              <a:s r="113">
                                 <a:s>Frequency</a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="114">
                                 <a:s>Quantity</a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    else </a:s>
                     <a:s r="121">
                        <a:s>ToDaily(</a:s>
                        <a:s r="120">
                           <a:s r="118">
                              <a:s>Frequency</a:s>
                           </a:s>
                           <a:s> as </a:s>
                           <a:s r="119">
                              <a:s>Code</a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>&#xd;
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="122" xsi:type="Case">
            <caseItem localId="117">
               <when localId="112" xsi:type="Is">
                  <operand localId="110" name="Frequency" xsi:type="OperandRef"/>
                  <isTypeSpecifier localId="111" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
               </when>
               <then localId="116" name="ToDaily" xsi:type="FunctionRef">
                  <operand localId="115" strict="false" xsi:type="As">
                     <operand localId="113" name="Frequency" xsi:type="OperandRef"/>
                     <asTypeSpecifier localId="114" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  </operand>
               </then>
            </caseItem>
            <else xsi:type="ToDecimal">
               <operand localId="121" name="ToDaily" xsi:type="FunctionRef">
                  <operand localId="120" strict="false" xsi:type="As">
                     <operand localId="118" name="Frequency" xsi:type="OperandRef"/>
                     <asTypeSpecifier localId="119" name="t:Code" xsi:type="NamedTypeSpecifier"/>
                  </operand>
               </operand>
            </else>
         </expression>
         <operand name="Frequency">
            <operandTypeSpecifier localId="109" xsi:type="ChoiceTypeSpecifier">
               <type localId="107" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
               <type localId="108" name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="134" name="CMD" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="134">
               <a:s>define function CMD(Order </a:s>
               <a:s r="124">
                  <a:s>&quot;Medication, Order&quot;</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="133">
                  <a:s r="133">
                     <a:s r="130">
                        <a:s r="126">
                           <a:s r="125">
                              <a:s>Order</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="126">
                              <a:s>supply</a:s>
                           </a:s>
                        </a:s>
                        <a:s> / </a:s>
                        <a:s r="129">
                           <a:s>ToDaily(</a:s>
                           <a:s r="128">
                              <a:s r="127">
                                 <a:s>Order</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="128">
                                 <a:s>frequency</a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s> * </a:s>
                     <a:s r="132">
                        <a:s r="131">
                           <a:s>Order</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="132">
                           <a:s>refills</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="133" xsi:type="Multiply">
            <operand localId="130" xsi:type="Divide">
               <operand localId="126" path="supply" xsi:type="Property">
                  <source localId="125" name="Order" xsi:type="OperandRef"/>
               </operand>
               <operand xsi:type="ToDecimal">
                  <operand localId="129" name="ToDaily" xsi:type="FunctionRef">
                     <operand localId="128" path="frequency" xsi:type="Property">
                        <source localId="127" name="Order" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </operand>
            </operand>
            <operand xsi:type="ToDecimal">
               <operand localId="132" path="refills" xsi:type="Property">
                  <source localId="131" name="Order" xsi:type="OperandRef"/>
               </operand>
            </operand>
         </expression>
         <operand name="Order">
            <operandTypeSpecifier localId="124" xmlns:ns1="urn:healthit-gov:qdm:v5_0_1_draft" name="ns1:PositiveMedicationOrder" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="142" name="CMD" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="142">
               <a:s>define function CMD(Medication </a:s>
               <a:s r="135">
                  <a:s>&quot;Medication, Active&quot;</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="141">
                  <a:s r="141">
                     <a:s r="137">
                        <a:s r="136">
                           <a:s>Medication</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="137">
                           <a:s>supply</a:s>
                        </a:s>
                     </a:s>
                     <a:s> / </a:s>
                     <a:s r="140">
                        <a:s>ToDaily(</a:s>
                        <a:s r="139">
                           <a:s r="138">
                              <a:s>Medication</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="139">
                              <a:s>frequency</a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="141" xsi:type="Divide">
            <operand localId="137" path="supply" xsi:type="Property">
               <source localId="136" name="Medication" xsi:type="OperandRef"/>
            </operand>
            <operand xsi:type="ToDecimal">
               <operand localId="140" name="ToDaily" xsi:type="FunctionRef">
                  <operand localId="139" path="frequency" xsi:type="Property">
                     <source localId="138" name="Medication" xsi:type="OperandRef"/>
                  </operand>
               </operand>
            </operand>
         </expression>
         <operand name="Medication">
            <operandTypeSpecifier localId="135" xmlns:ns2="urn:healthit-gov:qdm:v5_0_1_draft" name="ns2:MedicationActive" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="150" name="CMD" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="150">
               <a:s>define function CMD(Medication </a:s>
               <a:s r="143">
                  <a:s>&quot;Medication, Administered&quot;</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="149">
                  <a:s r="149">
                     <a:s r="145">
                        <a:s r="144">
                           <a:s>Medication</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="145">
                           <a:s>supply</a:s>
                        </a:s>
                     </a:s>
                     <a:s> / </a:s>
                     <a:s r="148">
                        <a:s>ToDaily(</a:s>
                        <a:s r="147">
                           <a:s r="146">
                              <a:s>Medication</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="147">
                              <a:s>frequency</a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="149" xsi:type="Divide">
            <operand localId="145" path="supply" xsi:type="Property">
               <source localId="144" name="Medication" xsi:type="OperandRef"/>
            </operand>
            <operand xsi:type="ToDecimal">
               <operand localId="148" name="ToDaily" xsi:type="FunctionRef">
                  <operand localId="147" path="frequency" xsi:type="Property">
                     <source localId="146" name="Medication" xsi:type="OperandRef"/>
                  </operand>
               </operand>
            </operand>
         </expression>
         <operand name="Medication">
            <operandTypeSpecifier localId="143" xmlns:ns3="urn:healthit-gov:qdm:v5_0_1_draft" name="ns3:PositiveMedicationAdministered" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="161" name="CMD" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="161">
               <a:s>define function CMD(Medication </a:s>
               <a:s r="151">
                  <a:s>&quot;Medication, Dispensed&quot;</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="160">
                  <a:s r="160">
                     <a:s r="157">
                        <a:s r="153">
                           <a:s r="152">
                              <a:s>Medication</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="153">
                              <a:s>supply</a:s>
                           </a:s>
                        </a:s>
                        <a:s> / </a:s>
                        <a:s r="156">
                           <a:s>ToDaily(</a:s>
                           <a:s r="155">
                              <a:s r="154">
                                 <a:s>Medication</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="155">
                                 <a:s>frequency</a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s> * </a:s>
                     <a:s r="159">
                        <a:s r="158">
                           <a:s>Medication</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="159">
                           <a:s>refills</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="160" xsi:type="Multiply">
            <operand localId="157" xsi:type="Divide">
               <operand localId="153" path="supply" xsi:type="Property">
                  <source localId="152" name="Medication" xsi:type="OperandRef"/>
               </operand>
               <operand xsi:type="ToDecimal">
                  <operand localId="156" name="ToDaily" xsi:type="FunctionRef">
                     <operand localId="155" path="frequency" xsi:type="Property">
                        <source localId="154" name="Medication" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </operand>
            </operand>
            <operand xsi:type="ToDecimal">
               <operand localId="159" path="refills" xsi:type="Property">
                  <source localId="158" name="Medication" xsi:type="OperandRef"/>
               </operand>
            </operand>
         </expression>
         <operand name="Medication">
            <operandTypeSpecifier localId="151" xmlns:ns4="urn:healthit-gov:qdm:v5_0_1_draft" name="ns4:PositiveMedicationDispensed" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="172" name="CMD" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="172">
               <a:s>define function CMD(Medication </a:s>
               <a:s r="162">
                  <a:s>&quot;Medication, Discharge&quot;</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="171">
                  <a:s r="171">
                     <a:s r="168">
                        <a:s r="164">
                           <a:s r="163">
                              <a:s>Medication</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="164">
                              <a:s>supply</a:s>
                           </a:s>
                        </a:s>
                        <a:s> / </a:s>
                        <a:s r="167">
                           <a:s>ToDaily(</a:s>
                           <a:s r="166">
                              <a:s r="165">
                                 <a:s>Medication</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="166">
                                 <a:s>frequency</a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s> * </a:s>
                     <a:s r="170">
                        <a:s r="169">
                           <a:s>Medication</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="170">
                           <a:s>refills</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="171" xsi:type="Multiply">
            <operand localId="168" xsi:type="Divide">
               <operand localId="164" path="supply" xsi:type="Property">
                  <source localId="163" name="Medication" xsi:type="OperandRef"/>
               </operand>
               <operand xsi:type="ToDecimal">
                  <operand localId="167" name="ToDaily" xsi:type="FunctionRef">
                     <operand localId="166" path="frequency" xsi:type="Property">
                        <source localId="165" name="Medication" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </operand>
            </operand>
            <operand xsi:type="ToDecimal">
               <operand localId="170" path="refills" xsi:type="Property">
                  <source localId="169" name="Medication" xsi:type="OperandRef"/>
               </operand>
            </operand>
         </expression>
         <operand name="Medication">
            <operandTypeSpecifier localId="162" xmlns:ns5="urn:healthit-gov:qdm:v5_0_1_draft" name="ns5:PositiveMedicationDischarge" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="187" name="CumulativeDuration" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="187">
               <a:s>define function CumulativeDuration(Intervals </a:s>
               <a:s r="175">
                  <a:s>List&lt;</a:s>
                  <a:s r="174">
                     <a:s>Interval&lt;</a:s>
                     <a:s r="173">
                        <a:s>DateTime</a:s>
                     </a:s>
                     <a:s>></a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="186">
                  <a:s r="186">
                     <a:s>Sum(</a:s>
                     <a:s r="185">
                        <a:s>
                           <a:s r="178">
                              <a:s r="177">
                                 <a:s>(</a:s>
                                 <a:s r="177">
                                    <a:s>collapse </a:s>
                                    <a:s r="176">
                                       <a:s>Intervals</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> X</a:s>
                           </a:s>
                        </a:s>
                        <a:s> </a:s>
                        <a:s r="184">
                           <a:s>return </a:s>
                           <a:s r="183">
                              <a:s>difference in days between </a:s>
                              <a:s r="180">
                                 <a:s>start of </a:s>
                                 <a:s r="179">
                                    <a:s>X</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> and </a:s>
                              <a:s r="182">
                                 <a:s>end of </a:s>
                                 <a:s r="181">
                                    <a:s>X</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="186" xsi:type="Sum">
            <source localId="185" xsi:type="Query">
               <source localId="178" alias="X">
                  <expression localId="177" xsi:type="Collapse">
                     <operand localId="176" name="Intervals" xsi:type="OperandRef"/>
                  </expression>
               </source>
               <return localId="184">
                  <expression localId="183" precision="Day" xsi:type="DifferenceBetween">
                     <operand localId="180" xsi:type="Start">
                        <operand localId="179" name="X" xsi:type="AliasRef"/>
                     </operand>
                     <operand localId="182" xsi:type="End">
                        <operand localId="181" name="X" xsi:type="AliasRef"/>
                     </operand>
                  </expression>
               </return>
            </source>
         </expression>
         <operand name="Intervals">
            <operandTypeSpecifier localId="175" xsi:type="ListTypeSpecifier">
               <elementType localId="174" xsi:type="IntervalTypeSpecifier">
                  <pointType localId="173" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </elementType>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="197" name="CMD" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="197">
               <a:s>define function CMD(Medications </a:s>
               <a:s r="189">
                  <a:s>List&lt;</a:s>
                  <a:s r="188">
                     <a:s>&quot;Medication, Administered&quot;</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="196">
                  <a:s r="196">
                     <a:s>CumulativeDuration(</a:s>
                     <a:s r="195">
                        <a:s>
                           <a:s r="191">
                              <a:s r="190">
                                 <a:s>
                                    <a:s>Medications</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> M</a:s>
                           </a:s>
                        </a:s>
                        <a:s> </a:s>
                        <a:s r="194">
                           <a:s>return </a:s>
                           <a:s r="193">
                              <a:s r="192">
                                 <a:s>M</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="193">
                                 <a:s>relevantPeriod</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="196" name="CumulativeDuration" xsi:type="FunctionRef">
            <operand localId="195" xsi:type="Query">
               <source localId="191" alias="M">
                  <expression localId="190" name="Medications" xsi:type="OperandRef"/>
               </source>
               <return localId="194">
                  <expression localId="193" path="relevantPeriod" scope="M" xsi:type="Property"/>
               </return>
            </operand>
         </expression>
         <operand name="Medications">
            <operandTypeSpecifier localId="189" xsi:type="ListTypeSpecifier">
               <elementType localId="188" xmlns:ns6="urn:healthit-gov:qdm:v5_0_1_draft" name="ns6:PositiveMedicationAdministered" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
   </statements>
</library>


